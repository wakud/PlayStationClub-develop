@page "{id}"
@model PlayStationClub.Pages.Room.RoomDetailsModel

@{
    ViewData["ImagePath"] = "/img/rooms/";
    var maxId = Model.Room.Images.Max(r => r.Id);
}

@if (Model.Room != null)
{
    <div class="room-details">
        <div id="carousel" class="carousel slide carousel-fade room-details__carousel" data-ride="carousel">
            <!--Slides-->
            <div class="carousel-inner" role="listbox">
                @foreach (var img in Model.Room.Images.Skip(1).OrderByDescending(g => g.Id))
                {
                    if (img.Id == maxId)
                    {
                        <div class="carousel-item active">
                            <img class="d-block w-100" src="@(ViewData["ImagePath"] + img.FileName)" />
                        </div>
                    }
                    else
                    {
                        <div class="carousel-item">
                            <img class="d-block w-100" src="@(ViewData["ImagePath"] + img.FileName)" />
                        </div>
                    }
                }
            </div>
            <!--/.Slides-->
            <!--Controls-->
            <a class="carousel-control-prev" href="#carousel-thumb" role="button" data-slide="prev">
                <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                <span class="sr-only">Previous</span>
            </a>
            <a class="carousel-control-next" href="#carousel-thumb" role="button" data-slide="next">
                <span class="carousel-control-next-icon" aria-hidden="true"></span>
                <span class="sr-only">Next</span>
            </a>
            <!--/.Controls-->
            <ol class="carousel-indicators">
                @foreach (var img in Model.Room.Images.Skip(1).OrderByDescending(g => g.Id))
                {
                    if (img.Id == maxId)
                    {
                        <li data-target="#carousel-thumb" data-slide-to="0" class="active"> 
                            <img class="d-block w-100" src="@(ViewData["ImagePath"] + img.FileName)" />
                        </li>
                    }
                    else
                    {
                        <li data-target="#carousel-thumb" data-slide-to="0"> 
                            <img class="d-block w-100" src="@(ViewData["ImagePath"] + img.FileName)" />
                        </li>
                    }
                }
            </ol>
        </div>
        <div class="room-details__content room-info">
            <h3 class="room-info__title">@Html.DisplayFor(Model => Model.Room.Name)</h3>
            <p class="room-info__text">@Html.DisplayFor(Model => Model.Room.Description)</p>
            <p class="room-info__player-numbers">Макс. кол-во игроков: <span>@Html.DisplayFor(Model => Model.Room.PlayersNumber)</span></p>
            @if (!User.Identity.IsAuthenticated)
            {
                <a class="room-info__book-btn" id="login" asp-area="Identity" asp-page="/Account/Login">
                    Войти и забронировать
                </a>
            }
            else
            {
                <a class="room-info__book-btn" asp-page="/Room/OrderSession">Забронировать</a>
                @*<a href="#" class="room-info__book-btn" onclick="OrderSession('?handler=OrderSession&Id=@(Model.Room.Id)')" 
                    data-toggle="modal" data-target="#order-session-modal">Забронировать</a>*@
            }
        </div>
    </div>
}

<!-- Modal RoomReservation -->
<div id="OrderSessionModal" class="modal fade" tabindex="-1" aria-labelledby="OrderSessionModalLabel" aria-hidden="true">
    <div id="dialogContent" class="modal-dialog modal-dialog-centered"></div>
</div>

@section Scripts {
    @{await Html.RenderPartialAsync("_ValidationScriptsPartial");}
    <script>
        $(document).ready(function () {
        OrderSession = (url) => {
            try {
                $.ajax({
                    type: 'GET',
                    url: url,
                    contentType: false,
                    processData: false,
                    success: function (res) {
                        $('#dialogContent').html(res);
                        $('#OrderSessionModal').modal('show');
                    },
                    error: function (err) {
                        console.log(err)
                    }
                })
                return false;
            } catch (ex) {
                console.log(ex)
            }
        }
    });
    </script>
}